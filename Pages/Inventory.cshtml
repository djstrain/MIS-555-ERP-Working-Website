@page
@model InventoryModel
@{
    ViewData["Title"] = "Inventory";
}

<h2 class="mb-4">Inventory</h2>


<div class="row g-3 mb-4">
    <div class="col-12 col-md-3">
        <form method="get" class="d-flex gap-2">
            <select name="Category" class="form-select" asp-for="Category">
                <option value="">All Categories</option>
                @foreach (var cat in Model.Categories)
                {
                    <option value="@cat" selected="@(Model.Category == cat)">@cat</option>
                }
            </select>
            <button class="btn btn-primary" type="submit">Filter</button>
        </form>
    </div>
    <div class="col-12 col-md-9">
        <div class="d-flex flex-wrap gap-2">
            <div class="card p-3">
                <div class="fw-semibold">Stock Value</div>
                <div>@Model.StockValue.ToString("C")</div>
            </div>
            <div class="card p-3">
                <div class="fw-semibold">Low Stock</div>
                <div>@Model.LowStockCount</div>
            </div>
            <div class="card p-3">
                <div class="fw-semibold">Items</div>
                <div>@Model.Items.Count</div>
            </div>
        </div>
    </div>
 </div>

<div class="mb-3">
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">Add Item</button>
 </div>

<table class="table table-striped">
    <thead>
        <tr>
            <th>SKU</th>
            <th>Name</th>
            <th>Category</th>
            <th>Qty</th>
            <th>Reorder</th>
            <th>Unit Cost</th>
            <th>Unit Price</th>
            <th>Location</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Items)
        {
            <tr>
                <td>@item.SKU</td>
                <td>@item.Name</td>
                <td>@item.Category</td>
                <td>@item.QuantityOnHand</td>
                <td>@item.ReorderLevel</td>
                <td>@item.UnitCost.ToString("C")</td>
                <td>@item.UnitPrice.ToString("C")</td>
                <td>@item.Location</td>
                <td class="text-nowrap">
                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editModal" data-id="@item.Id" data-sku="@item.SKU" data-name="@item.Name" data-category="@item.Category" data-qty="@item.QuantityOnHand" data-reorder="@item.ReorderLevel" data-cost="@item.UnitCost" data-price="@item.UnitPrice" data-location="@item.Location">Edit</button>
                    <form method="post" class="d-inline" asp-page-handler="Delete">
                        <input type="hidden" name="Id" value="@item.Id" />
                        <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
 </table>

<!-- Add Modal -->
<div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Inventory Item</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="post" asp-page-handler="Add">
        <div class="modal-body">
            <div class="row g-2">
                <div class="col-6">
                    <label class="form-label">SKU</label>
                    <input class="form-control" name="SKU" />
                </div>
                <div class="col-6">
                    <label class="form-label">Name</label>
                    <input class="form-control" name="Name" />
                </div>
                <div class="col-6">
                    <label class="form-label">Category</label>
                    <input class="form-control" name="Category" />
                </div>
                <div class="col-6">
                    <label class="form-label">Location</label>
                    <input class="form-control" name="Location" />
                </div>
                <div class="col-4">
                    <label class="form-label">Qty</label>
                    <input class="form-control" type="number" name="QuantityOnHand" />
                </div>
                <div class="col-4">
                    <label class="form-label">Reorder</label>
                    <input class="form-control" type="number" name="ReorderLevel" />
                </div>
                <div class="col-4">
                    <label class="form-label">Unit Cost</label>
                    <input class="form-control" type="number" step="0.01" name="UnitCost" />
                </div>
                <div class="col-4">
                    <label class="form-label">Unit Price</label>
                    <input class="form-control" type="number" step="0.01" name="UnitPrice" />
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Inventory Item</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="post" asp-page-handler="Edit">
        <div class="modal-body">
            <input type="hidden" name="Id" id="edit-id" />
            <div class="row g-2">
                <div class="col-6">
                    <label class="form-label">SKU</label>
                    <input class="form-control" name="SKU" id="edit-sku" />
                </div>
                <div class="col-6">
                    <label class="form-label">Name</label>
                    <input class="form-control" name="Name" id="edit-name" />
                </div>
                <div class="col-6">
                    <label class="form-label">Category</label>
                    <input class="form-control" name="Category" id="edit-category" />
                </div>
                <div class="col-6">
                    <label class="form-label">Location</label>
                    <input class="form-control" name="Location" id="edit-location" />
                </div>
                <div class="col-4">
                    <label class="form-label">Qty</label>
                    <input class="form-control" type="number" name="QuantityOnHand" id="edit-qty" />
                </div>
                <div class="col-4">
                    <label class="form-label">Reorder</label>
                    <input class="form-control" type="number" name="ReorderLevel" id="edit-reorder" />
                </div>
                <div class="col-4">
                    <label class="form-label">Unit Cost</label>
                    <input class="form-control" type="number" step="0.01" name="UnitCost" id="edit-cost" />
                </div>
                <div class="col-4">
                    <label class="form-label">Unit Price</label>
                    <input class="form-control" type="number" step="0.01" name="UnitPrice" id="edit-price" />
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.getElementById('editModal')?.addEventListener('show.bs.modal', function (event) {
  const button = event.relatedTarget;
  if (!button) return;
  const set = (id, val) => { const el = document.getElementById(id); if (el) el.value = val; };
  set('edit-id', button.getAttribute('data-id'));
  set('edit-sku', button.getAttribute('data-sku'));
  set('edit-name', button.getAttribute('data-name'));
  set('edit-category', button.getAttribute('data-category'));
  set('edit-location', button.getAttribute('data-location'));
  set('edit-qty', button.getAttribute('data-qty'));
  set('edit-reorder', button.getAttribute('data-reorder'));
  set('edit-cost', button.getAttribute('data-cost'));
  set('edit-price', button.getAttribute('data-price'));
});
</script>
