@page
@model FinancialManagementModel
@{
    ViewData["Title"] = "Financial Management";
}

<div class="container mt-5">
    <h1 class="mb-4">Financial Management Dashboard</h1>

    <!-- Display Messages -->
    @if (!string.IsNullOrEmpty(Model.Message))
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle"></i> @Model.Message
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle"></i> @Model.ErrorMessage
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Aggregate Metrics Cards -->
    <div class="row mb-5">
        <div class="col-md-4">
            <div class="card bg-light border-primary">
                <div class="card-body">
                    <h5 class="card-title">Total Revenue</h5>
                    <h3 class="text-primary">@Model.TotalRevenue.ToString("C")</h3>
                    <small class="text-muted">@Model.Invoices.Count invoices</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-light border-danger">
                <div class="card-body">
                    <h5 class="card-title">Total Expenses</h5>
                    <h3 class="text-danger">@Model.TotalExpenses.ToString("C")</h3>
                    <small class="text-muted">@Model.Accounts.Count(a => a.AccountType == "Expense") expense accounts</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-light border-success">
                <div class="card-body">
                    <h5 class="card-title">Net Balance</h5>
                    <h3 class="text-success">@Model.NetBalance.ToString("C")</h3>
                    <small class="text-muted">@Model.PaidInvoices paid invoices</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Account Form -->
    <div class="card mb-4 bg-light border-primary">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add New Account</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" asp-for="FormType" value="account" />
                <div class="row">
                    <div class="col-md-3">
                        <label for="NewAccountNumber" class="form-label">Account Number *</label>
                        <input type="text" class="form-control" id="NewAccountNumber" asp-for="NewAccountNumber" 
                               placeholder="e.g., 1500" required />
                    </div>
                    <div class="col-md-3">
                        <label for="NewAccountName" class="form-label">Account Name *</label>
                        <input type="text" class="form-control" id="NewAccountName" asp-for="NewAccountName" 
                               placeholder="e.g., Marketing Expense" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewAccountType" class="form-label">Account Type *</label>
                        <select class="form-select" id="NewAccountType" asp-for="NewAccountType" required>
                            <option value="">-- Select Type --</option>
                            <option value="Asset">Asset</option>
                            <option value="Liability">Liability</option>
                            <option value="Equity">Equity</option>
                            <option value="Revenue">Revenue</option>
                            <option value="Expense">Expense</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="NewAccountBalance" class="form-label">Opening Balance</label>
                        <input type="number" class="form-control" id="NewAccountBalance" asp-for="NewAccountBalance" 
                               placeholder="0.00" step="0.01" />
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-save"></i> Add Account
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Partner Form -->
    <div class="card mb-4 bg-light border-success">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add New Partner</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" asp-for="FormType" value="partner" />
                <div class="row">
                    <div class="col-md-3">
                        <label for="NewPartnerName" class="form-label">Partner Name *</label>
                        <input type="text" class="form-control" id="NewPartnerName" asp-for="NewPartnerName" 
                               placeholder="e.g., Acme Corp" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewPartnerType" class="form-label">Partner Type *</label>
                        <select class="form-select" id="NewPartnerType" asp-for="NewPartnerType" required>
                            <option value="">-- Select Type --</option>
                            <option value="Vendor">Vendor</option>
                            <option value="Customer">Customer</option>
                            <option value="Supplier">Supplier</option>
                            <option value="Associate">Associate</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="NewPartnerEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="NewPartnerEmail" asp-for="NewPartnerEmail"
                               placeholder="email@example.com" />
                    </div>
                    <div class="col-md-2">
                        <label for="NewPartnerPhone" class="form-label">Phone</label>
                        <input type="text" class="form-control" id="NewPartnerPhone" asp-for="NewPartnerPhone"
                               placeholder="(555) 123-4567" />
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-save"></i> Add Partner
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Invoice Form -->
    <div class="card mb-4 bg-light border-warning">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add New Invoice</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" asp-for="FormType" value="invoice" />
                <div class="row">
                    <div class="col-md-2">
                        <label for="NewInvoicePartnerId" class="form-label">Partner *</label>
                        <select class="form-select" id="NewInvoicePartnerId" asp-for="NewInvoicePartnerId" required>
                            <option value="0">-- Select Partner --</option>
                            @foreach (var partner in Model.Partners)
                            {
                                <option value="@partner.Id">@partner.PartnerName</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="NewInvoiceNumber" class="form-label">Invoice Number *</label>
                        <input type="text" class="form-control" id="NewInvoiceNumber" asp-for="NewInvoiceNumber" 
                               placeholder="e.g., INV-001" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewInvoiceAmount" class="form-label">Amount *</label>
                        <input type="number" class="form-control" id="NewInvoiceAmount" asp-for="NewInvoiceAmount" 
                               placeholder="0.00" step="0.01" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewInvoiceDate" class="form-label">Invoice Date</label>
                        <input type="date" class="form-control" id="NewInvoiceDate" asp-for="NewInvoiceDate" />
                    </div>
                    <div class="col-md-2">
                        <label for="NewInvoiceDueDate" class="form-label">Due Date</label>
                        <input type="date" class="form-control" id="NewInvoiceDueDate" asp-for="NewInvoiceDueDate" />
                    </div>
                    <div class="col-md-2">
                        <label for="NewInvoiceStatus" class="form-label">Status</label>
                        <select class="form-select" id="NewInvoiceStatus" asp-for="NewInvoiceStatus">
                            <option value="Pending">Pending</option>
                            <option value="Paid">Paid</option>
                            <option value="Overdue">Overdue</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-warning w-100">
                            <i class="fas fa-save"></i> Add Invoice
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Open Balance Form -->
    <div class="card mb-4 bg-light border-danger">
        <div class="card-header bg-danger text-white">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add Opening Balance</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" asp-for="FormType" value="openbalance" />
                <div class="row">
                    <div class="col-md-3">
                        <label for="NewOpenBalanceAccountId" class="form-label">Account *</label>
                        <select class="form-select" id="NewOpenBalanceAccountId" asp-for="NewOpenBalanceAccountId" required>
                            <option value="0">-- Select Account --</option>
                            @foreach (var account in Model.Accounts)
                            {
                                <option value="@account.Id">@account.AccountNumber - @account.AccountName</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="NewOpenBalanceAmount" class="form-label">Balance Amount *</label>
                        <input type="number" class="form-control" id="NewOpenBalanceAmount" asp-for="NewOpenBalanceAmount" 
                               placeholder="0.00" step="0.01" required />
                    </div>
                    <div class="col-md-3">
                        <label for="NewOpenBalanceDate" class="form-label">Balance Date</label>
                        <input type="date" class="form-control" id="NewOpenBalanceDate" asp-for="NewOpenBalanceDate" />
                    </div>
                    <div class="col-md-3">
                        <label for="NewOpenBalanceDescription" class="form-label">Description</label>
                        <input type="text" class="form-control" id="NewOpenBalanceDescription" asp-for="NewOpenBalanceDescription" placeholder="Optional description" />
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-danger w-100">
                            <i class="fas fa-save"></i> Add Balance
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Payment Form -->
    <div class="card mb-4 bg-light border-info">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Record Payment</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" asp-for="FormType" value="payment" />
                <div class="row">
                    <div class="col-md-2">
                        <label for="NewPaymentNumber" class="form-label">Payment Number *</label>
                        <input type="text" class="form-control" id="NewPaymentNumber" asp-for="NewPaymentNumber" placeholder="e.g., PAY-001" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewPaymentInvoiceId" class="form-label">Invoice *</label>
                        <select class="form-select" id="NewPaymentInvoiceId" asp-for="NewPaymentInvoiceId" required>
                            <option value="0">-- Select Invoice --</option>
                            @foreach (var invoice in Model.Invoices)
                            {
                                <option value="@invoice.Id">@invoice.InvoiceNumber (@invoice.Amount.ToString("C"))</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="NewPaymentAmount" class="form-label">Payment Amount *</label>
                        <input type="number" class="form-control" id="NewPaymentAmount" asp-for="NewPaymentAmount" 
                               placeholder="0.00" step="0.01" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewPaymentDate" class="form-label">Payment Date</label>
                        <input type="date" class="form-control" id="NewPaymentDate" asp-for="NewPaymentDate" />
                    </div>
                    <div class="col-md-3">
                        <label for="NewPaymentMethod" class="form-label">Payment Method</label>
                        <select class="form-select" id="NewPaymentMethod" asp-for="NewPaymentMethod">
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Check">Check</option>
                            <option value="Wire">Wire</option>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Cash">Cash</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-info w-100">
                            <i class="fas fa-save"></i> Record Payment
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Journal Entry Form -->
    <div class="card mb-4 bg-light border-secondary">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add Journal Entry</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" asp-for="FormType" value="journalentry" />
                <div class="row">
                    <div class="col-md-2">
                        <label for="NewJournalNumber" class="form-label">Journal Number *</label>
                        <input type="text" class="form-control" id="NewJournalNumber" asp-for="NewJournalNumber" placeholder="e.g., JE-001" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewJournalDebitAccountId" class="form-label">Debit Account *</label>
                        <select class="form-select" id="NewJournalDebitAccountId" asp-for="NewJournalDebitAccountId" required>
                            <option value="0">-- Select Account --</option>
                            @foreach (var account in Model.Accounts)
                            {
                                <option value="@account.Id">@account.AccountNumber</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="NewJournalCreditAccountId" class="form-label">Credit Account *</label>
                        <select class="form-select" id="NewJournalCreditAccountId" asp-for="NewJournalCreditAccountId" required>
                            <option value="0">-- Select Account --</option>
                            @foreach (var account in Model.Accounts)
                            {
                                <option value="@account.Id">@account.AccountNumber</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="NewJournalAmount" class="form-label">Amount *</label>
                        <input type="number" class="form-control" id="NewJournalAmount" asp-for="NewJournalAmount" 
                               placeholder="0.00" step="0.01" required />
                    </div>
                    <div class="col-md-3">
                        <label for="NewJournalDescription" class="form-label">Description</label>
                        <input type="text" class="form-control" id="NewJournalDescription" asp-for="NewJournalDescription" 
                               placeholder="Optional description" />
                    </div>
                    <div class="col-md-2">
                        <label for="NewJournalDate" class="form-label">Entry Date</label>
                        <input type="date" class="form-control" id="NewJournalDate" asp-for="NewJournalDate" />
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button type="submit" class="btn btn-secondary w-100">
                            <i class="fas fa-save"></i> Add
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Tax Rate Form -->
    <div class="card mb-4 bg-light border-dark">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add Tax Rate</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" asp-for="FormType" value="taxrate" />
                <div class="row">
                    <div class="col-md-2">
                        <label for="NewTaxCode" class="form-label">Tax Code *</label>
                        <input type="text" class="form-control" id="NewTaxCode" asp-for="NewTaxCode" 
                               placeholder="e.g., SALES-TAX" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewTaxPercentage" class="form-label">Percentage * (0-100)</label>
                        <input type="number" class="form-control" id="NewTaxPercentage" asp-for="NewTaxPercentage" 
                               placeholder="0.00" step="0.01" min="0" max="100" required />
                    </div>
                    <div class="col-md-3">
                        <label for="NewTaxDescription" class="form-label">Description</label>
                        <input type="text" class="form-control" id="NewTaxDescription" asp-for="NewTaxDescription" 
                               placeholder="e.g., Sales Tax Rate" />
                    </div>
                    <div class="col-md-2">
                        <label for="NewTaxType" class="form-label">Tax Type</label>
                        <input type="text" class="form-control" id="NewTaxType" asp-for="NewTaxType" placeholder="Sales Tax / State / Federal" />
                    </div>
                    <div class="col-md-2">
                        <label for="NewTaxEffectiveDate" class="form-label">Effective Date</label>
                        <input type="date" class="form-control" id="NewTaxEffectiveDate" asp-for="NewTaxEffectiveDate" />
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-dark w-100">
                            <i class="fas fa-save"></i> Add Tax Rate
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Invoice Line Form -->
    <div class="card mb-4 bg-light border-primary">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add Invoice Line</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" asp-for="FormType" value="invoiceline" />
                <div class="row">
                    <div class="col-md-3">
                        <label for="NewInvoiceLineInvoiceId" class="form-label">Invoice *</label>
                        <select class="form-select" id="NewInvoiceLineInvoiceId" asp-for="NewInvoiceLineInvoiceId" required>
                            <option value="0">-- Select Invoice --</option>
                            @foreach (var invoice in Model.Invoices)
                            {
                                <option value="@invoice.Id">@invoice.InvoiceNumber</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="NewInvoiceLineDescription" class="form-label">Description *</label>
                        <input type="text" class="form-control" id="NewInvoiceLineDescription" asp-for="NewInvoiceLineDescription" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewInvoiceLineQuantity" class="form-label">Qty *</label>
                        <input type="number" step="0.01" min="0" class="form-control" id="NewInvoiceLineQuantity" asp-for="NewInvoiceLineQuantity" required />
                    </div>
                    <div class="col-md-2">
                        <label for="NewInvoiceLineUnitPrice" class="form-label">Unit Price *</label>
                        <input type="number" step="0.01" min="0" class="form-control" id="NewInvoiceLineUnitPrice" asp-for="NewInvoiceLineUnitPrice" required />
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-save"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Data Tables Section -->
    <hr class="my-5" />
    <h2 class="mb-4">Financial Data</h2>
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Accounts</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Account Number</th>
                            <th>Account Name</th>
                            <th>Account Type</th>
                            <th>Balance</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var account in Model.Accounts)
                        {
                            <tr>
                                <td>@account.AccountNumber</td>
                                <td>@account.AccountName</td>
                                <td><span class="badge bg-info">@account.AccountType</span></td>
                                <td>@account.Balance.ToString("C")</td>
                                <td>@account.CreatedAt.ToString("MM/dd/yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Partners Table -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">Partners</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Partner Name</th>
                            <th>Partner Type</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var partner in Model.Partners)
                        {
                            <tr>
                                <td>@partner.PartnerName</td>
                                <td><span class="badge bg-warning">@partner.PartnerType</span></td>
                                <td>@partner.Email</td>
                                <td>@partner.Phone</td>
                                <td>@partner.CreatedAt.ToString("MM/dd/yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Invoices Table -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0">Invoices</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Invoice Number</th>
                            <th>Partner</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Invoice Date</th>
                            <th>Due Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var invoice in Model.Invoices)
                        {
                            <tr>
                                <td>@invoice.InvoiceNumber</td>
                                <td>@invoice.Partner?.PartnerName</td>
                                <td>@invoice.Amount.ToString("C")</td>
                                <td>
                                    @{
                                        var badgeClass = invoice.Status == "Paid" ? "bg-success" :
                                                       invoice.Status == "Pending" ? "bg-warning" : "bg-danger";
                                    }
                                    <span class="badge @badgeClass">@invoice.Status</span>
                                </td>
                                <td>@invoice.InvoiceDate.ToString("MM/dd/yyyy")</td>
                                <td>@invoice.DueDate.ToString("MM/dd/yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Open Balances Table -->
    <div class="card mb-4">
        <div class="card-header bg-danger text-white">
            <h5 class="mb-0">Open Balances</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Account</th>
                            <th>Opening Balance</th>
                            <th>Balance Date</th>
                            <th>Description</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var balance in Model.OpenBalances)
                        {
                            <tr>
                                <td>@balance.Account?.AccountName</td>
                                <td>@balance.OpeningBalance.ToString("C")</td>
                                <td>@balance.BalanceDate.ToString("MM/dd/yyyy")</td>
                                <td>@balance.Description</td>
                                <td>@balance.CreatedAt.ToString("MM/dd/yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Payments Table -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">Payments</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Payment Number</th>
                            <th>Invoice</th>
                            <th>Payment Amount</th>
                            <th>Payment Date</th>
                            <th>Payment Method</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var payment in Model.Payments)
                        {
                            <tr>
                                <td>@payment.PaymentNumber</td>
                                <td>@payment.Invoice?.InvoiceNumber</td>
                                <td>@payment.PaymentAmount.ToString("C")</td>
                                <td>@payment.PaymentDate.ToString("MM/dd/yyyy")</td>
                                <td><span class="badge bg-secondary">@payment.PaymentMethod</span></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Journal Entries Table -->
    <div class="card mb-4">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">Journal Entries</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Journal Number</th>
                            <th>Debit Account</th>
                            <th>Credit Account</th>
                            <th>Amount</th>
                            <th>Description</th>
                            <th>Entry Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var entry in Model.JournalEntries)
                        {
                            <tr>
                                <td>@entry.JournalNumber</td>
                                <td>@entry.DebitAccount?.AccountName</td>
                                <td>@entry.CreditAccount?.AccountName</td>
                                <td>@entry.Amount.ToString("C")</td>
                                <td>@entry.Description</td>
                                <td>@entry.EntryDate.ToString("MM/dd/yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Invoice Lines Table -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Invoice Lines</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Invoice #</th>
                            <th>Description</th>
                            <th>Qty</th>
                            <th>Unit Price</th>
                            <th>Line Total</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var line in Model.InvoiceLines)
                        {
                            <tr>
                                <td>@line.Invoice?.InvoiceNumber</td>
                                <td>@line.Description</td>
                                <td>@line.Quantity</td>
                                <td>@line.UnitPrice.ToString("C")</td>
                                <td>@line.LineTotal.ToString("C")</td>
                                <td>@line.CreatedAt.ToString("MM/dd/yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Journal Line Form -->
    <div class="card mb-4 bg-light border-secondary">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add Journal Line</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" asp-for="FormType" value="journalline" />
                <div class="row">
                    <div class="col-md-3">
                        <label for="NewJournalLineEntryId" class="form-label">Journal Entry *</label>
                        <select class="form-select" id="NewJournalLineEntryId" asp-for="NewJournalLineEntryId" required>
                            <option value="0">-- Select Entry --</option>
                            @foreach (var entry in Model.JournalEntries)
                            {
                                <option value="@entry.Id">@entry.JournalNumber</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="NewJournalLineAccountId" class="form-label">Account *</label>
                        <select class="form-select" id="NewJournalLineAccountId" asp-for="NewJournalLineAccountId" required>
                            <option value="0">-- Select Account --</option>
                            @foreach (var account in Model.Accounts)
                            {
                                <option value="@account.Id">@account.AccountNumber - @account.AccountName</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="NewJournalLineDebit" class="form-label">Debit</label>
                        <input type="number" step="0.01" min="0" class="form-control" id="NewJournalLineDebit" asp-for="NewJournalLineDebit" />
                    </div>
                    <div class="col-md-2">
                        <label for="NewJournalLineCredit" class="form-label">Credit</label>
                        <input type="number" step="0.01" min="0" class="form-control" id="NewJournalLineCredit" asp-for="NewJournalLineCredit" />
                    </div>
                    <div class="col-md-1">
                        <label for="NewJournalLineDescription" class="form-label">Desc</label>
                        <input type="text" class="form-control" id="NewJournalLineDescription" asp-for="NewJournalLineDescription" />
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button type="submit" class="btn btn-secondary w-100"><i class="fas fa-save"></i></button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Journal Lines Table -->
    <div class="card mb-4">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">Journal Lines</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Journal #</th>
                            <th>Account</th>
                            <th>Debit</th>
                            <th>Credit</th>
                            <th>Description</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var jl in Model.JournalLines)
                        {
                            <tr>
                                <td>@jl.JournalEntry?.JournalNumber</td>
                                <td>@jl.Account?.AccountName (@jl.Account?.AccountNumber)</td>
                                <td class="text-success">@jl.Debit.ToString("C")</td>
                                <td class="text-danger">@jl.Credit.ToString("C")</td>
                                <td>@jl.Description</td>
                                <td>@jl.CreatedAt.ToString("MM/dd/yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Tax Rates Table -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Tax Rates</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Tax Code</th>
                            <th>Tax Description</th>
                            <th>Rate</th>
                            <th>Tax Type</th>
                            <th>Effective Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var taxRate in Model.TaxRates)
                        {
                            <tr>
                                <td>@taxRate.TaxCode</td>
                                <td>@taxRate.TaxDescription</td>
                                <td>@(taxRate.Rate * 100)%</td>
                                <td><span class="badge bg-primary">@taxRate.TaxType</span></td>
                                <td>@taxRate.EffectiveDate.ToString("MM/dd/yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    body {
        background-color: transparent;
    }
    
    .card {
        background-color: rgba(255, 255, 255, 0.96);
        border: 1px solid #ddd;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .card-header {
        font-weight: bold;
    }
    
    .table {
        margin-bottom: 0;
        color: #000;
    }
    
    .table-hover tbody tr:hover {
        background-color: #f5f5f5;
    }
    
    h1 {
        color: #000;
        font-weight: bold;
    }
    
    .container {
        background-color: rgba(255, 255, 255, 0.02);
        border-radius: 8px;
        padding: 20px;
    }
</style>
